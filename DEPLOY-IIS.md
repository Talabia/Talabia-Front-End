# IIS Deployment Guide (MonsterASP.NET)

## Prerequisites

### On Your IIS Server (MonsterASP.NET):
1. **URL Rewrite Module** - Download and install from: https://www.iis.net/downloads/microsoft/url-rewrite
2. **Application Pool** configured with:
   - **.NET CLR Version**: No Managed Code
   - **Managed Pipeline Mode**: Integrated

## Quick Deploy

### Step 1: Build the Application

Run this command to build for IIS:

```bash
npm run build:iis
```

This will:
- Build your Angular app with production configuration
- Copy files from `dist/browser/` to `dist/`
- Include the `web.config` file for IIS URL rewriting
- Clean up unnecessary folders

### Step 2: Upload Files to MonsterASP.NET

1. Connect to your MonsterASP.NET hosting via FTP or File Manager
2. Navigate to your web root directory (usually `wwwroot` or `public_html`)
3. Upload **all files** from the `dist/` folder to your web root
   - Make sure to include the `web.config` file
   - Upload all folders: `assets/`, `media/`, etc.

### Step 3: Configure IIS (If you have access)

1. **Install URL Rewrite Module** (if not already installed):
   - Download from: https://www.iis.net/downloads/microsoft/url-rewrite
   - Or ask MonsterASP.NET support to install it

2. **Set Application Pool**:
   - Open IIS Manager
   - Right-click your website → Manage Website → Advanced Settings
   - Set Application Pool to one with:
     - **.NET CLR Version**: No Managed Code
     - **Pipeline Mode**: Integrated

3. **Verify web.config**:
   - The `web.config` file should be in your web root
   - It handles Angular routing via URL Rewrite rules

## Troubleshooting

### HTTP Error 502.5 - Process Failure

**Cause**: IIS is trying to run Angular as a Node.js app (wrong!)

**Solution**:
- Delete any existing `web.config` with `<httpPlatformHandler>`
- Use the `web.config` generated by `npm run build:iis`
- Make sure Application Pool is set to "No Managed Code"

### HTTP Error 500.19 - Configuration Error

**Cause**: URL Rewrite module is not installed

**Solution**:
- Install URL Rewrite module: https://www.iis.net/downloads/microsoft/url-rewrite
- Contact MonsterASP.NET support if you don't have server access

### Routes Don't Work (404 on refresh)

**Cause**: Missing or incorrect `web.config`

**Solution**:
- Ensure `web.config` exists in your web root
- Check that URL Rewrite rules are present in `web.config`
- Restart the application pool

### Static Files Not Loading (CSS, JS, Images)

**Cause**: Incorrect MIME types or permissions

**Solution**:
- The `web.config` includes common MIME types
- Check file permissions (IIS_IUSRS needs read access)
- Ensure all folders were uploaded correctly

### Wrong Base Path

**Cause**: App is deployed to a subdirectory, not root

**Solution**:
If deploying to a subdirectory (e.g., `yourdomain.com/myapp/`):

```bash
# Build with custom base href
ng build --configuration production --output-path dist --base-href /myapp/
node deploy-iis.js
```

## Manual Deployment (Without Script)

If you prefer to build manually:

1. Build the app:
   ```bash
   ng build --configuration production --output-path dist
   ```

2. Copy contents from `dist/browser/` to `dist/`

3. Verify `web.config` exists in `dist/`

4. Upload all files from `dist/` to your IIS web root

## File Structure on IIS

Your web root should look like this:

```
wwwroot/
├── web.config          ← IMPORTANT: Must be present!
├── index.html
├── favicon.ico
├── main-xxxxx.js
├── chunk-xxxxx.js
├── styles-xxxxx.css
├── assets/
│   └── (your assets)
├── media/
│   └── (fonts, images)
└── (other Angular files)
```

## Testing After Deployment

1. Navigate to your domain
2. Test direct routes (e.g., `yourdomain.com/some-page`)
3. Refresh the page - it should still work (not 404)
4. Check browser console for errors

## Important Notes

- **Do NOT** upload `node_modules/` or source files
- **Do NOT** use `HttpPlatformHandler` in web.config
- **DO** ensure `web.config` is in the web root
- **DO** verify URL Rewrite module is installed on IIS

## Need Help?

If you encounter issues:

1. Check IIS logs (usually in `C:\inetpub\logs\LogFiles`)
2. Enable detailed errors in `web.config` temporarily:
   ```xml
   <httpErrors errorMode="Detailed" />
   ```
3. Contact MonsterASP.NET support for IIS configuration help

## Subdirectory Deployment

If you need to deploy to a subdirectory instead of root:

```bash
# Example: Deploy to yourdomain.com/admin/
ng build --configuration production --output-path dist --base-href /admin/
node deploy-iis.js
```

Then update your `web.config` rewrite rule:
```xml
<action type="Rewrite" url="/admin/index.html" />
```
