<p-card header="Customer Support Messages">
  <div class="card">
    <p-table [value]="contacts" [scrollable]="true" [paginator]="true" [rows]="rows" [first]="first"
      [totalRecords]="totalRecords" [lazy]="true" showGridlines stripedRows
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" (onPage)="pageChange($event)"
      [rowsPerPageOptions]="[10, 25, 50]" scrollHeight="600px" [loading]="loading" [showCurrentPageReport]="true"
      paginatorPosition="bottom">

      <ng-template #header>
        <tr>
          <th style="min-width:200px">Name</th>
          <th style="min-width:150px">Phone</th>
          <th style="min-width:250px">Message</th>
          <th style="min-width:200px">Created At</th>
          <th style="min-width:120px">Status</th>
          <th style="min-width:250px">Actions</th>
        </tr>
      </ng-template>

      <ng-template #body let-contact>
        <tr>
          <td>{{contact.name}}</td>
          <td>{{contact.phone}}</td>
          <td>
            <div class="message-preview">
              {{contact.message.length > 100 ? (contact.message | slice:0:100) + '...' : contact.message}}
            </div>
          </td>
          <td>{{contact.createdAt}}</td>
          <td>
            @if (contact.isRead) {
            <p-tag severity="primary" value="Read" />
            } @else {
            <p-tag severity="warn" value="Unread" />
            }
          </td>
          <td>
            <div class="table-actions">
              <p-button label="View" [disabled]="loading" (click)="showViewDialog(contact)" />
              <p-button label="Resolve" severity="success" [disabled]="loading || contact.isRead"
                (click)="markAsRead(contact)" />
              <p-button label="Delete" severity="danger" [disabled]="loading"
                (click)="confirmDelete($event, contact)" />
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6">
            <div class="empty-container">
              <i class="pi pi-info-circle"></i>
              <h4>No customer messages available</h4>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</p-card>

<!-- View Details Dialog -->
<p-dialog header="Customer Message Details" [modal]="true" [(visible)]="viewDialogVisible" [style]="{ width: '40rem' }"
  [closable]="!loading" [draggable]="false" [resizable]="false">
  @if (selectedContact) {
  <div class="details-container">
    <div class="detail-row">
      <label class="detail-label">Name:</label>
      <span class="detail-value">{{selectedContact.name}}</span>
    </div>
    <div class="detail-row">
      <label class="detail-label">Phone:</label>
      <span class="detail-value">{{selectedContact.phone}}</span>
    </div>
    <div class="detail-row">
      <label class="detail-label">Created At:</label>
      <span class="detail-value">{{selectedContact.createdAt}}</span>
    </div>
    <div class="detail-row">
      <label class="detail-label">Status:</label>
      @if (selectedContact.isRead) {
      <p-tag severity="primary" value="Read" />
      } @else {
      <p-tag severity="warn" value="Unread" />
      }
    </div>
    <div class="detail-row message-row">
      <label class="detail-label">Message:</label>
      <p class="detail-message">{{selectedContact.message}}</p>
    </div>
  </div>

  <div class="dialog-footer">
    <p-button label="Close" severity="secondary" (click)="closeViewDialog()" />
    @if (!selectedContact.isRead) {
    <p-button label="Mark as Read" icon="pi pi-check" severity="success"
      (click)="markAsRead(selectedContact); closeViewDialog()" />
    }
  </div>
  }
</p-dialog>

<p-toast />
<p-confirmpopup />