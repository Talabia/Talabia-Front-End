<p-card [header]="'customerSupport.header' | translate">
  <div class="card">
    <p-table [value]="contacts" [scrollable]="true" [paginator]="true" [rows]="rows" [first]="first"
      [totalRecords]="totalRecords" [lazy]="true" showGridlines stripedRows
      [currentPageReportTemplate]="pageReportTemplate" (onPage)="pageChange($event)" [rowsPerPageOptions]="[10, 25, 50]"
      scrollHeight="600px" [loading]="loading" [showCurrentPageReport]="true" paginatorPosition="bottom">

      <ng-template #header>
        <tr>
          <th style="min-width:200px">{{'customerSupport.table.name' | translate}}</th>
          <th style="min-width:150px">{{'customerSupport.table.phone' | translate}}</th>
          <th style="min-width:250px">{{'customerSupport.table.message' | translate}}</th>
          <th style="min-width:200px">{{'customerSupport.table.createdAt' | translate}}</th>
          <th style="min-width:120px">{{'customerSupport.table.status' | translate}}</th>
          <th style="min-width:250px">{{'customerSupport.table.actions' | translate}}</th>
        </tr>
      </ng-template>

      <ng-template #body let-contact>
        <tr>
          <td>{{contact.name}}</td>
          <td>{{contact.phone}}</td>
          <td>
            <div class="message-preview">
              {{contact.message.length > 100 ? (contact.message | slice:0:100) + '...' : contact.message}}
            </div>
          </td>
          <td>{{contact.createdAt}}</td>
          <td>
            @if (contact.isRead) {
            <p-tag severity="primary" [value]="'customerSupport.status.read' | translate" />
            } @else {
            <p-tag severity="warn" [value]="'customerSupport.status.unread' | translate" />
            }
          </td>
          <td>
            <div class="table-actions">
              <p-button [label]="'customerSupport.button.view' | translate" [disabled]="loading"
                (click)="showViewDialog(contact)" />
              <p-button [label]="'customerSupport.button.resolve' | translate" severity="success"
                [disabled]="loading || contact.isRead" (click)="markAsRead(contact)" />
              <p-button [label]="'customerSupport.button.delete' | translate" severity="danger" [disabled]="loading"
                (click)="confirmDelete($event, contact)" />
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6">
            <div class="empty-container">
              <i class="pi pi-info-circle"></i>
              <h4>{{'customerSupport.empty.default' | translate}}</h4>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</p-card>

<!-- View Details Dialog -->
<p-dialog [header]="'customerSupport.dialog.header' | translate" [modal]="true" [(visible)]="viewDialogVisible"
  [style]="{ width: '40rem' }" [closable]="!loading" [draggable]="false" [resizable]="false">
  @if (selectedContact) {
  <div class="details-container">
    <div class="detail-row">
      <label class="detail-label">{{'customerSupport.dialog.name' | translate}}:</label>
      <span class="detail-value">{{selectedContact.name}}</span>
    </div>
    <div class="detail-row">
      <label class="detail-label">{{'customerSupport.dialog.phone' | translate}}:</label>
      <span class="detail-value">{{selectedContact.phone}}</span>
    </div>
    <div class="detail-row">
      <label class="detail-label">{{'customerSupport.dialog.createdAt' | translate}}:</label>
      <span class="detail-value">{{selectedContact.createdAt}}</span>
    </div>
    <div class="detail-row">
      <label class="detail-label">{{'customerSupport.dialog.status' | translate}}:</label>
      @if (selectedContact.isRead) {
      <p-tag severity="primary" [value]="'customerSupport.status.read' | translate" />
      } @else {
      <p-tag severity="warn" [value]="'customerSupport.status.unread' | translate" />
      }
    </div>
    <div class="detail-row message-row">
      <label class="detail-label">{{'customerSupport.dialog.message' | translate}}:</label>
      <p class="detail-message">{{selectedContact.message}}</p>
    </div>
  </div>

  <div class="dialog-footer">
    <p-button [label]="'customerSupport.button.close' | translate" severity="secondary" (click)="closeViewDialog()" />
    @if (!selectedContact.isRead) {
    <p-button [label]="'customerSupport.button.markAsRead' | translate" icon="pi pi-check" severity="success"
      (click)="markAsRead(selectedContact); closeViewDialog()" />
    }
  </div>
  }
</p-dialog>

<p-toast />
<p-confirmpopup />