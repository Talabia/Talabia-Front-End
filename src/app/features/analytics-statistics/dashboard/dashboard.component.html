<p-card header="Reports Analytics Dashboard">
    <div class="card">
        <!-- Filters Section -->
        <div class="action-container">
            <p-select [options]="filterOptions" [(ngModel)]="selectedFilter" optionLabel="label" optionValue="value"
                placeholder="Filter by Time Period" [disabled]="loading" [showClear]="false"
                (onChange)="onFilterChange()" />

            <p-button label="Refresh" icon="pi pi-refresh" severity="secondary" [loading]="loading"
                (click)="loadDashboardData()" />
        </div>

        <!-- Loading Spinner -->
        @if (loading) {
        <div class="loading-container">
            <p-progressSpinner />
            <p>Loading dashboard data...</p>
        </div>
        }

        <!-- Dashboard Content -->
        @if (!loading && statistics) {
        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card total">
                <div class="card-content">
                    <div class="card-icon">
                        <i class="pi pi-chart-bar"></i>
                    </div>
                    <div class="card-info">
                        <h3>{{getTotalReports()}}</h3>
                        <p>Total Reports</p>
                    </div>
                </div>
            </div>

            <div class="summary-card pending">
                <div class="card-content">
                    <div class="card-icon">
                        <i class="pi pi-clock"></i>
                    </div>
                    <div class="card-info">
                        <h3>{{statistics.pendingReports}}</h3>
                        <p>Pending</p>
                        <small>{{getStatusPercentage('pending')}}% of total</small>
                    </div>
                </div>
            </div>

            <div class="summary-card under-review">
                <div class="card-content">
                    <div class="card-icon">
                        <i class="pi pi-eye"></i>
                    </div>
                    <div class="card-info">
                        <h3>{{statistics.underReviewReports}}</h3>
                        <p>Under Review</p>
                        <small>{{getStatusPercentage('underReview')}}% of total</small>
                    </div>
                </div>
            </div>

            <div class="summary-card resolved">
                <div class="card-content">
                    <div class="card-icon">
                        <i class="pi pi-check-circle"></i>
                    </div>
                    <div class="card-info">
                        <h3>{{statistics.resolvedReports}}</h3>
                        <p>Resolved</p>
                        <small>{{getStatusPercentage('resolved')}}% of total</small>
                    </div>
                </div>
            </div>

            <div class="summary-card rejected">
                <div class="card-content">
                    <div class="card-icon">
                        <i class="pi pi-times-circle"></i>
                    </div>
                    <div class="card-info">
                        <h3>{{statistics.rejectedReports}}</h3>
                        <p>Rejected</p>
                        <small>{{getStatusPercentage('rejected')}}% of total</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-container">
            <!-- Status Distribution Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h4>Reports by Status</h4>
                    <p-tag value="Pie Chart" severity="info" />
                </div>
                @if (statusChartData) {
                <div class="chart-wrapper">
                    <p-chart type="pie" [data]="statusChartData" [options]="pieChartOptions" height="300px" />
                </div>
                }
            </div>

            <!-- Type Distribution Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h4>Reports by Type</h4>
                    <p-tag value="Doughnut Chart" severity="success" />
                </div>
                @if (typeChartData) {
                <div class="chart-wrapper">
                    <p-chart type="doughnut" [data]="typeChartData" [options]="pieChartOptions" height="300px" />
                </div>
                }
            </div>

            <!-- Reason Distribution Chart -->
            <div class="chart-card full-width">
                <div class="chart-header">
                    <h4>Reports by Reason</h4>
                    <p-tag value="Bar Chart" severity="warn" />
                </div>
                @if (reasonChartData) {
                <div class="chart-wrapper">
                    <p-chart type="bar" [data]="reasonChartData" [options]="barChartOptions" height="400px" />
                </div>
                }
            </div>

            <!-- Timeline Chart -->
            <div class="chart-card full-width">
                <div class="chart-header">
                    <h4>Reports Timeline (Last 7 Days)</h4>
                    <p-tag value="Line Chart" severity="secondary" />
                </div>
                @if (timelineChartData) {
                <div class="chart-wrapper">
                    <p-chart type="line" [data]="timelineChartData" [options]="lineChartOptions" height="400px" />
                </div>
                }
            </div>
        </div>
        }

        <!-- Empty State -->
        @if (!loading && !statistics) {
        <div class="empty-container">
            <i class="pi pi-chart-bar"></i>
            <h4>No Data Available</h4>
            <p>Unable to load dashboard statistics. Please try refreshing the page.</p>
            <p-button label="Retry" icon="pi pi-refresh" severity="primary" (click)="loadDashboardData()" />
        </div>
        }
    </div>
</p-card>

<p-toast />