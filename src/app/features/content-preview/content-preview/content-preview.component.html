<p-card [header]="'contentPreview.header' | translate">
  <div class="card">
    <div class="action-container">
      <p-button (click)="showCreateDialog()" [label]="'contentPreview.button.create' | translate" icon="pi pi-plus"
        [disabled]="loading" />
    </div>
    <p-table [value]="contents" [scrollable]="true" [paginator]="true" [rows]="rows" [first]="first"
      [totalRecords]="totalRecords" [lazy]="true" showGridlines stripedRows
      [currentPageReportTemplate]="pageReportTemplate" (onPage)="pageChange($event)" [rowsPerPageOptions]="[10, 25, 50]"
      scrollHeight="600px" [loading]="loading" [showCurrentPageReport]="true" paginatorPosition="bottom">

      <ng-template #header>
        <tr>
          <th style="min-width:200px">{{'contentPreview.table.title' | translate}}</th>
          <th style="min-width:150px">{{'contentPreview.table.type' | translate}}</th>
          <th style="min-width:200px">{{'contentPreview.table.actions' | translate}}</th>
        </tr>
      </ng-template>

      <ng-template #body let-content>
        <tr>
          <td>{{content.title}}</td>
          <td>{{getContentTypeLabel(content.type)}}</td>
          <td>
            <div class="table-actions">
              <p-button [pTooltip]="'contentPreview.button.preview' | translate" icon="pi pi-eye"
                [disabled]="loading" (click)="showPreviewDialog(content)" />
              <p-button [pTooltip]="'contentPreview.button.edit' | translate" severity="success" icon="pi pi-pencil"
                [disabled]="loading" (click)="showEditDialog(content)" />
              <p-button [pTooltip]="'contentPreview.button.delete' | translate" severity="danger" icon="pi pi-trash"
                [disabled]="loading" (click)="confirmDelete($event, content)" />
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="3">
            <div class="empty-container">
              <i class="pi pi-info-circle"></i>
              <h4>{{'contentPreview.empty.default' | translate}}</h4>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</p-card>

<!-- Create/Edit Dialog -->
<p-dialog [header]="dialogTitle" [modal]="true" [(visible)]="createEditDialogVisible" [style]="{ width: '50rem' }"
  [closable]="!loading" [draggable]="false" [resizable]="false">

  <form [formGroup]="contentForm" (ngSubmit)="saveContent()">
    <!-- Type Select -->
    <div class="input-container">
      <label for="type" class="font-semibold w-24">{{'contentPreview.field.type' | translate}}
        <span>*</span></label>
      <p-select id="type" formControlName="type" [options]="contentTypeOptions" optionLabel="label" optionValue="value"
        [placeholder]="'contentPreview.field.typePlaceholder' | translate" [disabled]="loading"
        [invalid]="hasError('type')" class="flex-auto" />

      @if (hasError('type') || contentForm.get('type')?.dirty || contentForm.get('type')?.touched ) {
      <p-message severity="error" size="small" variant="simple">
        {{getErrorMessage('type')}}
      </p-message>
      }
    </div>

    <!-- Title Arabic -->
    <div class="input-container">
      <label for="titleAr" class="font-semibold w-24">{{'contentPreview.field.titleAr' | translate}}
        <span>*</span></label>
      <input pInputText id="titleAr" formControlName="titleAr" class="flex-auto" autocomplete="off"
        [disabled]="loading" [invalid]="hasError('titleAr')" />

      @if (hasError('titleAr') || contentForm.get('titleAr')?.dirty || contentForm.get('titleAr')?.touched ) {
      <p-message severity="error" size="small" variant="simple">
        {{getErrorMessage('titleAr')}}
      </p-message>
      }
    </div>

    <!-- Title English -->
    <div class="input-container">
      <label for="titleEn" class="font-semibold w-24">{{'contentPreview.field.titleEn' | translate}}
        <span>*</span></label>
      <input pInputText id="titleEn" formControlName="titleEn" class="flex-auto" autocomplete="off"
        [disabled]="loading" [invalid]="hasError('titleEn')" />

      @if (hasError('titleEn') || contentForm.get('titleEn')?.dirty || contentForm.get('titleEn')?.touched ) {
      <p-message severity="error" size="small" variant="simple">
        {{getErrorMessage('titleEn')}}
      </p-message>
      }
    </div>

    <!-- Content Arabic -->
    <div class="input-container">
      <label for="contentAr" class="font-semibold w-24">{{'contentPreview.field.contentAr' | translate}}
        <span>*</span></label>
      <p-editor formControlName="contentAr" [style]="{ height: '320px' }" [disabled]="loading" />

      @if (hasError('contentAr') || contentForm.get('contentAr')?.dirty || contentForm.get('contentAr')?.touched ) {
      <p-message severity="error" size="small" variant="simple">
        {{getErrorMessage('contentAr')}}
      </p-message>
      }
    </div>

    <!-- Content English -->
    <div class="input-container">
      <label for="contentEn" class="font-semibold w-24">{{'contentPreview.field.contentEn' | translate}}
        <span>*</span></label>
      <p-editor formControlName="contentEn" [style]="{ height: '320px' }" [disabled]="loading" />

      @if (hasError('contentEn') || contentForm.get('contentEn')?.dirty || contentForm.get('contentEn')?.touched ) {
      <p-message severity="error" size="small" variant="simple">
        {{getErrorMessage('contentEn')}}
      </p-message>
      }
    </div>

    <div class="dialog-footer">
      <p-button [label]="'contentPreview.button.cancel' | translate" severity="secondary" type="button"
        [disabled]="loading" (click)="cancelDialog()" />
      <p-button [label]="(isEditMode ? 'contentPreview.button.update' : 'contentPreview.button.create') | translate"
        type="submit" [loading]="loading" [disabled]="contentForm.invalid && submitted" />
    </div>
  </form>
</p-dialog>

<!-- Preview Dialog -->
<p-dialog [header]="'contentPreview.dialog.previewTitle' | translate" [modal]="true"
  [(visible)]="previewDialogVisible" [style]="{ width: '50rem' }" [closable]="!loading" [draggable]="false"
  [resizable]="false">

  @if (previewContent) {
  <div class="preview-container">
    <div class="preview-row">
      <label class="preview-label">{{'contentPreview.field.type' | translate}}:</label>
      <span class="preview-value">{{getContentTypeLabel(previewContent.type)}}</span>
    </div>
    <div class="preview-row">
      <label class="preview-label">{{'contentPreview.field.titleAr' | translate}}:</label>
      <span class="preview-value">{{previewContent.titleAr}}</span>
    </div>
    <div class="preview-row">
      <label class="preview-label">{{'contentPreview.field.titleEn' | translate}}:</label>
      <span class="preview-value">{{previewContent.titleEn}}</span>
    </div>
    <div class="preview-row">
      <label class="preview-label">{{'contentPreview.field.contentAr' | translate}}:</label>
      <div class="preview-content" [innerHTML]="previewContent.contentAr"></div>
    </div>
    <div class="preview-row">
      <label class="preview-label">{{'contentPreview.field.contentEn' | translate}}:</label>
      <div class="preview-content" [innerHTML]="previewContent.contentEn"></div>
    </div>
  </div>

  <div class="dialog-footer">
    <p-button [label]="'contentPreview.button.close' | translate" severity="secondary"
      (click)="closePreviewDialog()" />
  </div>
  }
</p-dialog>

<p-toast />
<p-confirmpopup />
